<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>聖書通読チェックアプリ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            padding: 10px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .progress-message {
            background: #e8f5e8;
            padding: 15px;
            text-align: center;
            font-weight: bold;
            color: #2e7d32;
        }
        
        .today-reading-panel {
            background: #f0f8ff;
            border: 1px solid #ddd;
            margin: 15px;
            padding: 20px;
            border-radius: 8px;
        }
        
        .confirm-button {
            background: #4caf50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 15px;
        }
        
        .confirm-button:hover {
            background: #45a049;
        }
        
        .confirm-button:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }
        
        .reading-today {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            margin: 5px 0;
            padding: 8px 12px;
        }
        
        .today-chapters {
            margin-top: 10px;
        }

        .main-content {
            display: flex;
            min-height: 80vh;
        }

        .left-panel {
            flex: 0 0 400px;
            border-right: 1px solid #ddd;
            overflow-y: auto;
            max-height: 80vh;
            background: #fafafa;
        }

        .checklist-panel {
            flex: 1;
            overflow-y: auto;
            max-height: 80vh;
            padding: 15px;
        }

        .calendar-section {
            padding: 20px;
            border-bottom: 1px solid #ddd;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .calendar-nav {
            background: #667eea;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
        }

        .calendar-nav:hover {
            background: #5a6fd8;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            margin-bottom: 10px;
            font-size: 12px;
        }

        .calendar-day-header {
            text-align: center;
            font-weight: bold;
            padding: 5px;
            background: #e0e0e0;
            font-size: 12px;
        }

        .calendar-day {
            border: 1px solid #ddd;
            padding: 3px;
            text-align: center;
            cursor: pointer;
            min-height: 30px;
            background: white;
            position: relative;
            font-size: 11px;
        }

        .calendar-day:hover {
            background: #f0f0f0;
        }

        .calendar-day.other-month {
            color: #ccc;
            background: #f9f9f9;
        }

        .calendar-day.today {
            background: #e3f2fd;
            border-color: #2196f3;
            font-weight: bold;
        }

        .calendar-day.completed {
            background: #c8e6c9;
            color: #2e7d32;
        }

        .chapter-count {
            font-size: 10px;
            color: #666;
            margin-top: 2px;
        }

        .day-input-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            max-width: 400px;
            width: 90%;
        }

        .modal-header {
            font-weight: bold;
            margin-bottom: 15px;
        }

        .input-group {
            margin: 10px 0;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
        }

        .input-group input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 15px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .btn-primary {
            background: #1976d2;
            color: white;
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .bible-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            max-height: 80vh;
            background: white;
        }

        .testament {
            margin-bottom: 20px;
        }

        .testament-title {
            background: #f0f0f0;
            padding: 10px;
            font-weight: bold;
            border-bottom: 2px solid #ddd;
        }

        .book {
            margin-bottom: 10px;
        }

        .book-title {
            background: #f8f8f8;
            padding: 8px 15px;
            font-weight: bold;
            color: #333;
            border-left: 4px solid #667eea;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .book-toggle {
            background: #667eea;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }

        .book-toggle:hover {
            background: #5a6fd8;
        }

        .book-content {
            display: block;
        }

        .book-content.hidden {
            display: none;
        }

        .chapters {
            padding: 5px 15px;
        }

        .chapter-grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 3px;
            margin: 10px 0;
        }

        .chapter-item {
            padding: 8px 4px;
            background: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 12px;
            min-height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .chapter-item:hover {
            background: #e3f2fd;
            border-color: #2196f3;
        }

        .chapter-item.completed {
            background: #c8e6c9;
            border-color: #4caf50;
            color: #2e7d32;
        }

        .chapter-checkbox {
            margin-bottom: 2px;
        }

        .chapter-link {
            color: #1976d2;
            text-decoration: none;
            font-size: 14px;
            margin-top: 2px;
        }

        .chapter-link:hover {
            color: #0d47a1;
        }

        .bible-text {
            line-height: 1.6;
            color: #333;
        }

        .bible-iframe {
            width: 100%;
            height: 500px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .left-panel {
                flex: none;
                border-right: none;
                border-bottom: 1px solid #ddd;
                max-height: 40vh;
            }
            
            .calendar-section {
                max-height: 20vh;
            }
            
            .checklist-panel {
                max-height: 20vh;
            }
            
            .bible-content {
                max-height: 40vh;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>聖書通読チェックアプリ</h1>
            <p>口語訳聖書を使った通読管理</p>
        </div>
        
        <div class="progress-message" id="progressMessage">
            今日の進捗を確認してください
        </div>
        
        <div class="today-reading-panel">
            <h3>今日の読書記録</h3>
            <div id="todayReadingList"></div>
            <button class="confirm-button" id="confirmButton" onclick="confirmTodayReading()">通読確定</button>
        </div>
        
        <div class="main-content">
            <div class="left-panel">
                <div class="checklist-panel" id="checklistPanel">
                    <h3>聖書通読表</h3>
                    <!-- チェックリストがここに動的に生成されます -->
                </div>
            </div>
            
            <div class="bible-content" id="bibleContent">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3>聖書本文表示</h3>
                    <a href="https://www.wordproject.org/bibles/jp/" target="_blank" style="display: inline-block; padding: 8px 16px; background: #1976d2; color: white; text-decoration: none; border-radius: 4px; font-size: 14px;">口語訳聖書へ</a>
                </div>
                <p>左側の聖書通読表から章を選択すると、口語訳聖書の本文が表示されます。</p>
                <div id="bibleDisplay"></div>
            </div>
        </div>
    </div>

    <!-- 日付入力モーダル -->
    <div class="day-input-modal" id="dayInputModal">
        <div class="modal-content">
            <div class="modal-header" id="modalHeader">章数を入力</div>
            <div class="input-group">
                <label for="chapterInput">読んだ章数:</label>
                <input type="number" id="chapterInput" min="0" max="20" value="0">
            </div>
            <div class="input-group">
                <label>
                    <input type="checkbox" id="completedCheckbox"> この日の読書を完了
                </label>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="closeModal()">キャンセル</button>
                <button class="btn btn-primary" onclick="saveDay()">保存</button>
            </div>
        </div>
    </div>

    <script>
        // 聖書の章データ
        const bibleData = {
            "旧約聖書": {
                "創世記": 50, "出エジプト記": 40, "レビ記": 27, "民数記": 36, "申命記": 34,
                "ヨシュア記": 24, "士師記": 21, "ルツ記": 4, "サムエル記上": 31, "サムエル記下": 24,
                "列王記上": 22, "列王記下": 25, "歴代志上": 29, "歴代志下": 36, "エズラ記": 10,
                "ネヘミヤ記": 13, "エステル記": 10, "ヨブ記": 42, "詩篇": 150, "箴言": 31,
                "伝道の書": 12, "雅歌": 8, "イザヤ書": 66, "エレミヤ書": 52, "哀歌": 5,
                "エゼキエル書": 48, "ダニエル書": 12, "ホセア書": 14, "ヨエル書": 3, "アモス書": 9,
                "オバデヤ書": 1, "ヨナ書": 4, "ミカ書": 7, "ナホム書": 3, "ハバクク書": 3,
                "ゼパニヤ書": 3, "ハガイ書": 2, "ゼカリヤ書": 14, "マラキ書": 4
            },
            "新約聖書": {
                "マタイによる福音書": 28, "マルコによる福音書": 16, "ルカによる福音書": 24, "ヨハネによる福音書": 21,
                "使徒行伝": 28, "ローマ人への手紙": 16, "コリント人への第一の手紙": 16, "コリント人への第二の手紙": 13,
                "ガラテヤ人への手紙": 6, "エペソ人への手紙": 6, "ピリピ人への手紙": 4, "コロサイ人への手紙": 4,
                "テサロニケ人への第一の手紙": 5, "テサロニケ人への第二の手紙": 3, "テモテへの第一の手紙": 6,
                "テモテへの第二の手紙": 4, "テトスへの手紙": 3, "ピレモンへの手紙": 1, "ヘブル人への手紙": 13,
                "ヤコブの手紙": 5, "ペテロの第一の手紙": 5, "ペテロの第二の手紙": 3, "ヨハネの第一の手紙": 5,
                "ヨハネの第二の手紙": 1, "ヨハネの第三の手紙": 1, "ユダの手紙": 1, "ヨハネの黙示録": 22
            }
        };

        // ローカルストレージのキー
        const STORAGE_KEY = 'bible_reading_progress';
        const DAILY_PROGRESS_KEY = 'daily_reading_progress';
        const CALENDAR_DATA_KEY = 'calendar_reading_data';

        // カレンダー関連の変数
        let currentDate = new Date();
        let selectedDate = null;

        // 進捗データの取得
        function getProgress() {
            const saved = localStorage.getItem(STORAGE_KEY);
            return saved ? JSON.parse(saved) : {};
        }

        // 進捗データの保存
        function saveProgress(progress) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(progress));
        }

        // 今日の日付を取得（YYYY-MM-DD形式）
        function getTodayKey() {
            return new Date().toISOString().split('T')[0];
        }

        // 今日の進捗を取得
        function getTodayProgress() {
            const saved = localStorage.getItem(DAILY_PROGRESS_KEY);
            const dailyProgress = saved ? JSON.parse(saved) : {};
            const today = getTodayKey();
            return dailyProgress[today] || 0;
        }

        // 今日の進捗を保存
        function saveTodayProgress(count) {
            const saved = localStorage.getItem(DAILY_PROGRESS_KEY);
            const dailyProgress = saved ? JSON.parse(saved) : {};
            const today = getTodayKey();
            dailyProgress[today] = count;
            localStorage.setItem(DAILY_PROGRESS_KEY, JSON.stringify(dailyProgress));
        }

        // カレンダーデータの取得
        function getCalendarData() {
            const saved = localStorage.getItem(CALENDAR_DATA_KEY);
            return saved ? JSON.parse(saved) : {};
        }

        // カレンダーデータの保存
        function saveCalendarData(data) {
            localStorage.setItem(CALENDAR_DATA_KEY, JSON.stringify(data));
        }

        // 日付文字列の取得（YYYY-MM-DD形式）
        function getDateKey(date) {
            return date.toISOString().split('T')[0];
        }

        // カレンダーの生成
        function generateCalendar() {
            const calendarGrid = document.getElementById('calendarGrid');
            const currentMonthEl = document.getElementById('currentMonth');
            
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            currentMonthEl.textContent = `${year}年${month + 1}月`;
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            const calendarData = getCalendarData();
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            let html = '';
            
            // 曜日ヘッダー
            const dayHeaders = ['日', '月', '火', '水', '木', '金', '土'];
            dayHeaders.forEach(day => {
                html += `<div class="calendar-day-header">${day}</div>`;
            });
            
            // カレンダーの日付
            for (let i = 0; i < 42; i++) {
                const currentDateInLoop = new Date(startDate);
                currentDateInLoop.setDate(startDate.getDate() + i);
                
                const dateKey = getDateKey(currentDateInLoop);
                const dayData = calendarData[dateKey] || { chapters: 0, completed: false };
                
                let dayClass = 'calendar-day';
                if (currentDateInLoop.getMonth() !== month) {
                    dayClass += ' other-month';
                }
                if (currentDateInLoop.getTime() === today.getTime()) {
                    dayClass += ' today';
                }
                if (dayData.completed) {
                    dayClass += ' completed';
                }
                
                html += `<div class="${dayClass}" onclick="openDayModal('${dateKey}')">`;
                html += `<div>${currentDateInLoop.getDate()}</div>`;
                if (dayData.chapters > 0) {
                    html += `<div class="chapter-count">${dayData.chapters}章</div>`;
                }
                html += `</div>`;
            }
            
            calendarGrid.innerHTML = html;
        }

        // 月の変更
        function changeMonth(direction) {
            currentDate.setMonth(currentDate.getMonth() + direction);
            generateCalendar();
        }

        // 日付モーダルを開く
        function openDayModal(dateKey) {
            selectedDate = dateKey;
            const calendarData = getCalendarData();
            const dayData = calendarData[dateKey] || { chapters: 0, completed: false };
            
            const date = new Date(dateKey);
            document.getElementById('modalHeader').textContent = `${date.getMonth() + 1}月${date.getDate()}日の読書記録`;
            document.getElementById('chapterInput').value = dayData.chapters;
            document.getElementById('completedCheckbox').checked = dayData.completed;
            
            document.getElementById('dayInputModal').style.display = 'flex';
        }

        // モーダルを閉じる
        function closeModal() {
            document.getElementById('dayInputModal').style.display = 'none';
            selectedDate = null;
        }

        // 日付データを保存
        function saveDay() {
            if (!selectedDate) return;
            
            const chapters = parseInt(document.getElementById('chapterInput').value) || 0;
            const completed = document.getElementById('completedCheckbox').checked;
            
            const calendarData = getCalendarData();
            calendarData[selectedDate] = { chapters, completed };
            saveCalendarData(calendarData);
            
            generateCalendar();
            updateProgressMessage();
            closeModal();
        }

        // 書の表示/非表示を切り替え
        function toggleBook(bookId) {
            const bookContent = document.getElementById(`book-${bookId}`);
            const toggleButton = document.getElementById(`toggle-${bookId}`);
            
            if (bookContent.classList.contains('hidden')) {
                bookContent.classList.remove('hidden');
                toggleButton.textContent = '非表示';
            } else {
                bookContent.classList.add('hidden');
                toggleButton.textContent = '表示';
            }
        }
        
        // チェックリストの生成
        function generateChecklist() {
            const panel = document.getElementById('checklistPanel');
            const progress = getProgress();
            const todayList = getTodayReadingList();
            let html = '';

            Object.keys(bibleData).forEach(testament => {
                html += `<div class="testament">`;
                html += `<div class="testament-title">${testament}</div>`;
                
                Object.keys(bibleData[testament]).forEach(book => {
                    const chapterCount = bibleData[testament][book];
                    html += `<div class="book">`;
                    const bookId = book.replace(/[^a-zA-Z0-9]/g, '');
                    html += `<div class="book-title">`;
                    html += `<span>${book} (${chapterCount}章)</span>`;
                    html += `<button class="book-toggle" onclick="toggleBook('${bookId}')" id="toggle-${bookId}">表示</button>`;
                    html += `</div>`;
                    html += `<div class="chapters book-content" id="book-${book.replace(/[^a-zA-Z0-9]/g, '')}">`;            
                    html += `<div class="chapter-grid">`;
                    
                    for (let chapter = 1; chapter <= chapterCount; chapter++) {
                        const chapterKey = `${book}_${chapter}`;
                        const isCompleted = progress[chapterKey] || false;
                        const isTodaySelected = todayList.includes(chapterKey);
                        const completedClass = isCompleted ? 'completed' : '';
                        
                        html += `<div class="chapter-item ${completedClass}" data-book="${book}" data-chapter="${chapter}" title="${book} ${chapter}章">`;
                        html += `<div style="display: flex; flex-direction: column; align-items: center; width: 100%;">`;
                        html += `<div style="font-weight: bold; font-size: 14px; margin-bottom: 2px;">${chapter}</div>`;
                        if (!isCompleted) {
                            html += `<input type="checkbox" class="chapter-checkbox" ${isTodaySelected ? 'checked' : ''} onchange="toggleChapter('${chapterKey}', this.checked)">`;
                        } else {
                            html += `<input type="checkbox" class="chapter-checkbox" checked disabled>`;
                        }
                        html += `<a href="#" class="chapter-link" onclick="openBibleText('${book}', ${chapter})" title="聖書本文を表示">📖</a>`;
                        html += `</div>`;
                        html += `</div>`;
                    }
                    
                    html += `</div></div></div>`;
                });
                
                html += `</div>`;
            });

            panel.innerHTML = html;
        }

        // 今日の読書リストデータの取得
        function getTodayReadingList() {
            const saved = localStorage.getItem('today_reading_list');
            return saved ? JSON.parse(saved) : [];
        }
        
        // 今日の読書リストデータの保存
        function saveTodayReadingList(list) {
            localStorage.setItem('today_reading_list', JSON.stringify(list));
        }
        
        // チェック状態の切り替え（今日の読書用）
        function toggleChapter(chapterKey, isChecked) {
            let todayList = getTodayReadingList();
            
            if (isChecked) {
                if (!todayList.includes(chapterKey)) {
                    todayList.push(chapterKey);
                }
            } else {
                todayList = todayList.filter(key => key !== chapterKey);
            }
            
            saveTodayReadingList(todayList);
            updateTodayReadingDisplay();
            
            // 視覚的フィードバック
            const chapterItem = document.querySelector(`[data-book="${chapterKey.split('_')[0]}"][data-chapter="${chapterKey.split('_')[1]}"]`);
            if (chapterItem) {
                if (isChecked) {
                    chapterItem.classList.add('completed');
                } else {
                    chapterItem.classList.remove('completed');
                }
            }
        }

        // 今日の読書表示を更新
        function updateTodayReadingDisplay() {
            const todayList = getTodayReadingList();
            const todayReadingListEl = document.getElementById('todayReadingList');
            
            if (todayList.length === 0) {
                todayReadingListEl.innerHTML = '<p>今日読む予定の章を選択してください。</p>';
            } else {
                let html = '<div class="today-chapters">';
                todayList.forEach(chapterKey => {
                    const [book, chapter] = chapterKey.split('_');
                    html += `<div class="reading-today">${book} ${chapter}章</div>`;
                });
                html += '</div>';
                todayReadingListEl.innerHTML = html;
            }
        }
        
        // 今日の読書を確定
        function confirmTodayReading() {
            const todayList = getTodayReadingList();
            const chapterCount = todayList.length;
            
            // 進捗データに保存
            const progress = getProgress();
            todayList.forEach(chapterKey => {
                progress[chapterKey] = true;
            });
            saveProgress(progress);
            
            // カレンダーデータに保存
            const today = getTodayKey();
            const calendarData = getCalendarData();
            calendarData[today] = { 
                chapters: chapterCount, 
                completed: true,
                readChapters: todayList
            };
            saveCalendarData(calendarData);
            
            // 今日のリストをクリア
            saveTodayReadingList([]);
            
            // 表示を更新
            generateChecklist();
            updateTodayReadingDisplay();
            updateProgressMessage(chapterCount);
            
            // 評価メッセージを表示
            showEvaluationMessage(chapterCount);
        }
        
        // 評価メッセージを表示
        function showEvaluationMessage(chapterCount) {
            let message = '';
            let title = '今日の読書結果';
            
            if (chapterCount === 0) {
                message = '今日は読めませんでした。明日は頑張りましょう。';
            } else if (chapterCount >= 1 && chapterCount <= 2) {
                message = `今日は${chapterCount}章読めました。3章まであと少しです。頑張りましょう。`;
            } else if (chapterCount >= 3) {
                message = `今日は${chapterCount}章読めましたね。3章以上読めました。頑張りましたね。`;
            }
            
            alert(`${title}\n\n${message}`);
        }
        
        // 進捗メッセージの更新
        function updateProgressMessage(chapterCount = null) {
            const messageEl = document.getElementById('progressMessage');
            
            if (chapterCount === null) {
                const today = getTodayKey();
                const calendarData = getCalendarData();
                const todayData = calendarData[today] || { chapters: 0, completed: false };
                chapterCount = todayData.chapters;
            }
            
            if (chapterCount === 0) {
                messageEl.textContent = '今日は読めませんでした。明日は頑張りましょう。';
            } else if (chapterCount >= 1 && chapterCount <= 2) {
                messageEl.textContent = '今日は3章までもう少しです。頑張りましょう。';
            } else if (chapterCount >= 3) {
                messageEl.textContent = '今日は3章以上読めましたね。頑張りましたね。';
            }
        }

        // 聖書本文を開く
        function openBibleText(book, chapter) {
            const bibleDisplay = document.getElementById('bibleDisplay');
            const salterraeUrl = `https://www.wordproject.org/bibles/jp/`;
            
            bibleDisplay.innerHTML = `
                <h4>${book} ${chapter}章</h4>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 5px; margin: 10px 0;">
                    <p style="margin-bottom: 10px;"><strong>選択された箇所:</strong> ${book} ${chapter}章</p>
                    <p style="margin-bottom: 15px;">口語訳聖書の本文を読むには、以下のサイトをご利用ください：</p>
                    <div style="margin: 15px 0;">
                        <a href="${salterraeUrl}" target="_blank" style="display: inline-block; padding: 10px 15px; background: #1976d2; color: white; text-decoration: none; border-radius: 4px; margin: 5px;">口語訳聖書サイトで読む</a>
                    </div>
                </div>
                <div style="margin-top: 20px; border: 1px solid #ddd; border-radius: 5px;">
                    <iframe src="${salterraeUrl}" class="bible-iframe" title="口語訳聖書 - ${book} ${chapter}章"></iframe>
                </div>
            `;
        }

        // 初期化
        function init() {
            generateChecklist();
            updateTodayReadingDisplay();
            updateProgressMessage();
        }

        // ページ読み込み時に初期化
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>