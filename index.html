<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è–æ›¸é€šèª­ãƒã‚§ãƒƒã‚¯ã‚¢ãƒ—ãƒª</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            padding: 10px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .progress-message {
            background: #e8f5e8;
            padding: 15px;
            text-align: center;
            font-weight: bold;
            color: #2e7d32;
        }
        
        .today-reading-panel {
            background: #f0f8ff;
            border: 1px solid #ddd;
            margin: 15px;
            padding: 20px;
            border-radius: 8px;
        }
        
        .confirm-button {
            background: #4caf50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 15px;
        }
        
        .confirm-button:hover {
            background: #45a049;
        }
        
        .confirm-button:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }
        
        .reading-today {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            margin: 5px 0;
            padding: 8px 12px;
        }
        
        .today-chapters {
            margin-top: 10px;
        }

        .main-content {
            display: flex;
            min-height: 80vh;
        }

        .left-panel {
            flex: 0 0 400px;
            border-right: 1px solid #ddd;
            overflow-y: auto;
            max-height: 80vh;
            background: #fafafa;
        }

        .checklist-panel {
            flex: 1;
            overflow-y: auto;
            max-height: 80vh;
            padding: 15px;
        }

        .calendar-section {
            padding: 20px;
            border-bottom: 1px solid #ddd;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .calendar-nav {
            background: #667eea;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
        }

        .calendar-nav:hover {
            background: #5a6fd8;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            margin-bottom: 10px;
            font-size: 12px;
        }

        .calendar-day-header {
            text-align: center;
            font-weight: bold;
            padding: 5px;
            background: #e0e0e0;
            font-size: 12px;
        }

        .calendar-day {
            border: 1px solid #ddd;
            padding: 3px;
            text-align: center;
            cursor: pointer;
            min-height: 30px;
            background: white;
            position: relative;
            font-size: 11px;
        }

        .calendar-day:hover {
            background: #f0f0f0;
        }

        .calendar-day.other-month {
            color: #ccc;
            background: #f9f9f9;
        }

        .calendar-day.today {
            background: #e3f2fd;
            border-color: #2196f3;
            font-weight: bold;
        }

        .calendar-day.completed {
            background: #c8e6c9;
            color: #2e7d32;
        }

        .chapter-count {
            font-size: 10px;
            color: #666;
            margin-top: 2px;
        }

        .day-input-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            max-width: 400px;
            width: 90%;
        }

        .modal-header {
            font-weight: bold;
            margin-bottom: 15px;
        }

        .input-group {
            margin: 10px 0;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
        }

        .input-group input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 15px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .btn-primary {
            background: #1976d2;
            color: white;
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .bible-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            max-height: 80vh;
            background: white;
        }

        .testament {
            margin-bottom: 20px;
        }

        .testament-title {
            background: #f0f0f0;
            padding: 10px;
            font-weight: bold;
            border-bottom: 2px solid #ddd;
        }

        .book {
            margin-bottom: 10px;
        }

        .book-title {
            background: #f8f8f8;
            padding: 8px 15px;
            font-weight: bold;
            color: #333;
            border-left: 4px solid #667eea;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .book-toggle {
            background: #667eea;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }

        .book-toggle:hover {
            background: #5a6fd8;
        }

        .book-content {
            display: block;
        }

        .book-content.hidden {
            display: none;
        }

        .chapters {
            padding: 5px 15px;
        }

        .chapter-grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 3px;
            margin: 10px 0;
        }

        .chapter-item {
            padding: 8px 4px;
            background: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 12px;
            min-height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .chapter-item:hover {
            background: #e3f2fd;
            border-color: #2196f3;
        }

        .chapter-item.completed {
            background: #c8e6c9;
            border-color: #4caf50;
            color: #2e7d32;
        }

        .chapter-checkbox {
            margin-bottom: 2px;
        }

        .chapter-link {
            color: #1976d2;
            text-decoration: none;
            font-size: 14px;
            margin-top: 2px;
        }

        .chapter-link:hover {
            color: #0d47a1;
        }

        .bible-text {
            line-height: 1.6;
            color: #333;
        }

        .bible-iframe {
            width: 100%;
            height: 500px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .left-panel {
                flex: none;
                border-right: none;
                border-bottom: 1px solid #ddd;
                max-height: 40vh;
            }
            
            .calendar-section {
                max-height: 20vh;
            }
            
            .checklist-panel {
                max-height: 20vh;
            }
            
            .bible-content {
                max-height: 40vh;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>è–æ›¸é€šèª­ãƒã‚§ãƒƒã‚¯ã‚¢ãƒ—ãƒª</h1>
            <p>å£èªè¨³è–æ›¸ã‚’ä½¿ã£ãŸé€šèª­ç®¡ç†</p>
        </div>
        
        <div class="progress-message" id="progressMessage">
            ä»Šæ—¥ã®é€²æ—ã‚’ç¢ºèªã—ã¦ãã ã•ã„
        </div>
        
        <div class="today-reading-panel">
            <h3>ä»Šæ—¥ã®èª­æ›¸è¨˜éŒ²</h3>
            <div id="todayReadingList"></div>
            <button class="confirm-button" id="confirmButton" onclick="confirmTodayReading()">é€šèª­ç¢ºå®š</button>
        </div>
        
        <div class="main-content">
            <div class="left-panel">
                <div class="checklist-panel" id="checklistPanel">
                    <h3>è–æ›¸é€šèª­è¡¨</h3>
                    <!-- ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆãŒã“ã“ã«å‹•çš„ã«ç”Ÿæˆã•ã‚Œã¾ã™ -->
                </div>
            </div>
            
            <div class="bible-content" id="bibleContent">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3>è–æ›¸æœ¬æ–‡è¡¨ç¤º</h3>
                    <a href="https://www.wordproject.org/bibles/jp/" target="_blank" style="display: inline-block; padding: 8px 16px; background: #1976d2; color: white; text-decoration: none; border-radius: 4px; font-size: 14px;">å£èªè¨³è–æ›¸ã¸</a>
                </div>
                <p>å·¦å´ã®è–æ›¸é€šèª­è¡¨ã‹ã‚‰ç« ã‚’é¸æŠã™ã‚‹ã¨ã€å£èªè¨³è–æ›¸ã®æœ¬æ–‡ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
                <div id="bibleDisplay"></div>
            </div>
        </div>
    </div>

    <!-- æ—¥ä»˜å…¥åŠ›ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="day-input-modal" id="dayInputModal">
        <div class="modal-content">
            <div class="modal-header" id="modalHeader">ç« æ•°ã‚’å…¥åŠ›</div>
            <div class="input-group">
                <label for="chapterInput">èª­ã‚“ã ç« æ•°:</label>
                <input type="number" id="chapterInput" min="0" max="20" value="0">
            </div>
            <div class="input-group">
                <label>
                    <input type="checkbox" id="completedCheckbox"> ã“ã®æ—¥ã®èª­æ›¸ã‚’å®Œäº†
                </label>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="closeModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button class="btn btn-primary" onclick="saveDay()">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <script>
        // è–æ›¸ã®ç« ãƒ‡ãƒ¼ã‚¿
        const bibleData = {
            "æ—§ç´„è–æ›¸": {
                "å‰µä¸–è¨˜": 50, "å‡ºã‚¨ã‚¸ãƒ—ãƒˆè¨˜": 40, "ãƒ¬ãƒ“è¨˜": 27, "æ°‘æ•°è¨˜": 36, "ç”³å‘½è¨˜": 34,
                "ãƒ¨ã‚·ãƒ¥ã‚¢è¨˜": 24, "å£«å¸«è¨˜": 21, "ãƒ«ãƒ„è¨˜": 4, "ã‚µãƒ ã‚¨ãƒ«è¨˜ä¸Š": 31, "ã‚µãƒ ã‚¨ãƒ«è¨˜ä¸‹": 24,
                "åˆ—ç‹è¨˜ä¸Š": 22, "åˆ—ç‹è¨˜ä¸‹": 25, "æ­´ä»£å¿—ä¸Š": 29, "æ­´ä»£å¿—ä¸‹": 36, "ã‚¨ã‚ºãƒ©è¨˜": 10,
                "ãƒãƒ˜ãƒŸãƒ¤è¨˜": 13, "ã‚¨ã‚¹ãƒ†ãƒ«è¨˜": 10, "ãƒ¨ãƒ–è¨˜": 42, "è©©ç¯‡": 150, "ç®´è¨€": 31,
                "ä¼é“ã®æ›¸": 12, "é›…æ­Œ": 8, "ã‚¤ã‚¶ãƒ¤æ›¸": 66, "ã‚¨ãƒ¬ãƒŸãƒ¤æ›¸": 52, "å“€æ­Œ": 5,
                "ã‚¨ã‚¼ã‚­ã‚¨ãƒ«æ›¸": 48, "ãƒ€ãƒ‹ã‚¨ãƒ«æ›¸": 12, "ãƒ›ã‚»ã‚¢æ›¸": 14, "ãƒ¨ã‚¨ãƒ«æ›¸": 3, "ã‚¢ãƒ¢ã‚¹æ›¸": 9,
                "ã‚ªãƒãƒ‡ãƒ¤æ›¸": 1, "ãƒ¨ãƒŠæ›¸": 4, "ãƒŸã‚«æ›¸": 7, "ãƒŠãƒ›ãƒ æ›¸": 3, "ãƒãƒã‚¯ã‚¯æ›¸": 3,
                "ã‚¼ãƒ‘ãƒ‹ãƒ¤æ›¸": 3, "ãƒã‚¬ã‚¤æ›¸": 2, "ã‚¼ã‚«ãƒªãƒ¤æ›¸": 14, "ãƒãƒ©ã‚­æ›¸": 4
            },
            "æ–°ç´„è–æ›¸": {
                "ãƒã‚¿ã‚¤ã«ã‚ˆã‚‹ç¦éŸ³æ›¸": 28, "ãƒãƒ«ã‚³ã«ã‚ˆã‚‹ç¦éŸ³æ›¸": 16, "ãƒ«ã‚«ã«ã‚ˆã‚‹ç¦éŸ³æ›¸": 24, "ãƒ¨ãƒãƒã«ã‚ˆã‚‹ç¦éŸ³æ›¸": 21,
                "ä½¿å¾’è¡Œä¼": 28, "ãƒ­ãƒ¼ãƒäººã¸ã®æ‰‹ç´™": 16, "ã‚³ãƒªãƒ³ãƒˆäººã¸ã®ç¬¬ä¸€ã®æ‰‹ç´™": 16, "ã‚³ãƒªãƒ³ãƒˆäººã¸ã®ç¬¬äºŒã®æ‰‹ç´™": 13,
                "ã‚¬ãƒ©ãƒ†ãƒ¤äººã¸ã®æ‰‹ç´™": 6, "ã‚¨ãƒšã‚½äººã¸ã®æ‰‹ç´™": 6, "ãƒ”ãƒªãƒ”äººã¸ã®æ‰‹ç´™": 4, "ã‚³ãƒ­ã‚µã‚¤äººã¸ã®æ‰‹ç´™": 4,
                "ãƒ†ã‚µãƒ­ãƒ‹ã‚±äººã¸ã®ç¬¬ä¸€ã®æ‰‹ç´™": 5, "ãƒ†ã‚µãƒ­ãƒ‹ã‚±äººã¸ã®ç¬¬äºŒã®æ‰‹ç´™": 3, "ãƒ†ãƒ¢ãƒ†ã¸ã®ç¬¬ä¸€ã®æ‰‹ç´™": 6,
                "ãƒ†ãƒ¢ãƒ†ã¸ã®ç¬¬äºŒã®æ‰‹ç´™": 4, "ãƒ†ãƒˆã‚¹ã¸ã®æ‰‹ç´™": 3, "ãƒ”ãƒ¬ãƒ¢ãƒ³ã¸ã®æ‰‹ç´™": 1, "ãƒ˜ãƒ–ãƒ«äººã¸ã®æ‰‹ç´™": 13,
                "ãƒ¤ã‚³ãƒ–ã®æ‰‹ç´™": 5, "ãƒšãƒ†ãƒ­ã®ç¬¬ä¸€ã®æ‰‹ç´™": 5, "ãƒšãƒ†ãƒ­ã®ç¬¬äºŒã®æ‰‹ç´™": 3, "ãƒ¨ãƒãƒã®ç¬¬ä¸€ã®æ‰‹ç´™": 5,
                "ãƒ¨ãƒãƒã®ç¬¬äºŒã®æ‰‹ç´™": 1, "ãƒ¨ãƒãƒã®ç¬¬ä¸‰ã®æ‰‹ç´™": 1, "ãƒ¦ãƒ€ã®æ‰‹ç´™": 1, "ãƒ¨ãƒãƒã®é»™ç¤ºéŒ²": 22
            }
        };

        // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ã‚­ãƒ¼
        const STORAGE_KEY = 'bible_reading_progress';
        const DAILY_PROGRESS_KEY = 'daily_reading_progress';
        const CALENDAR_DATA_KEY = 'calendar_reading_data';

        // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é–¢é€£ã®å¤‰æ•°
        let currentDate = new Date();
        let selectedDate = null;

        // é€²æ—ãƒ‡ãƒ¼ã‚¿ã®å–å¾—
        function getProgress() {
            const saved = localStorage.getItem(STORAGE_KEY);
            return saved ? JSON.parse(saved) : {};
        }

        // é€²æ—ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜
        function saveProgress(progress) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(progress));
        }

        // ä»Šæ—¥ã®æ—¥ä»˜ã‚’å–å¾—ï¼ˆYYYY-MM-DDå½¢å¼ï¼‰
        function getTodayKey() {
            return new Date().toISOString().split('T')[0];
        }

        // ä»Šæ—¥ã®é€²æ—ã‚’å–å¾—
        function getTodayProgress() {
            const saved = localStorage.getItem(DAILY_PROGRESS_KEY);
            const dailyProgress = saved ? JSON.parse(saved) : {};
            const today = getTodayKey();
            return dailyProgress[today] || 0;
        }

        // ä»Šæ—¥ã®é€²æ—ã‚’ä¿å­˜
        function saveTodayProgress(count) {
            const saved = localStorage.getItem(DAILY_PROGRESS_KEY);
            const dailyProgress = saved ? JSON.parse(saved) : {};
            const today = getTodayKey();
            dailyProgress[today] = count;
            localStorage.setItem(DAILY_PROGRESS_KEY, JSON.stringify(dailyProgress));
        }

        // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ‡ãƒ¼ã‚¿ã®å–å¾—
        function getCalendarData() {
            const saved = localStorage.getItem(CALENDAR_DATA_KEY);
            return saved ? JSON.parse(saved) : {};
        }

        // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜
        function saveCalendarData(data) {
            localStorage.setItem(CALENDAR_DATA_KEY, JSON.stringify(data));
        }

        // æ—¥ä»˜æ–‡å­—åˆ—ã®å–å¾—ï¼ˆYYYY-MM-DDå½¢å¼ï¼‰
        function getDateKey(date) {
            return date.toISOString().split('T')[0];
        }

        // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®ç”Ÿæˆ
        function generateCalendar() {
            const calendarGrid = document.getElementById('calendarGrid');
            const currentMonthEl = document.getElementById('currentMonth');
            
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            currentMonthEl.textContent = `${year}å¹´${month + 1}æœˆ`;
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            const calendarData = getCalendarData();
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            let html = '';
            
            // æ›œæ—¥ãƒ˜ãƒƒãƒ€ãƒ¼
            const dayHeaders = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
            dayHeaders.forEach(day => {
                html += `<div class="calendar-day-header">${day}</div>`;
            });
            
            // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®æ—¥ä»˜
            for (let i = 0; i < 42; i++) {
                const currentDateInLoop = new Date(startDate);
                currentDateInLoop.setDate(startDate.getDate() + i);
                
                const dateKey = getDateKey(currentDateInLoop);
                const dayData = calendarData[dateKey] || { chapters: 0, completed: false };
                
                let dayClass = 'calendar-day';
                if (currentDateInLoop.getMonth() !== month) {
                    dayClass += ' other-month';
                }
                if (currentDateInLoop.getTime() === today.getTime()) {
                    dayClass += ' today';
                }
                if (dayData.completed) {
                    dayClass += ' completed';
                }
                
                html += `<div class="${dayClass}" onclick="openDayModal('${dateKey}')">`;
                html += `<div>${currentDateInLoop.getDate()}</div>`;
                if (dayData.chapters > 0) {
                    html += `<div class="chapter-count">${dayData.chapters}ç« </div>`;
                }
                html += `</div>`;
            }
            
            calendarGrid.innerHTML = html;
        }

        // æœˆã®å¤‰æ›´
        function changeMonth(direction) {
            currentDate.setMonth(currentDate.getMonth() + direction);
            generateCalendar();
        }

        // æ—¥ä»˜ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
        function openDayModal(dateKey) {
            selectedDate = dateKey;
            const calendarData = getCalendarData();
            const dayData = calendarData[dateKey] || { chapters: 0, completed: false };
            
            const date = new Date(dateKey);
            document.getElementById('modalHeader').textContent = `${date.getMonth() + 1}æœˆ${date.getDate()}æ—¥ã®èª­æ›¸è¨˜éŒ²`;
            document.getElementById('chapterInput').value = dayData.chapters;
            document.getElementById('completedCheckbox').checked = dayData.completed;
            
            document.getElementById('dayInputModal').style.display = 'flex';
        }

        // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
        function closeModal() {
            document.getElementById('dayInputModal').style.display = 'none';
            selectedDate = null;
        }

        // æ—¥ä»˜ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
        function saveDay() {
            if (!selectedDate) return;
            
            const chapters = parseInt(document.getElementById('chapterInput').value) || 0;
            const completed = document.getElementById('completedCheckbox').checked;
            
            const calendarData = getCalendarData();
            calendarData[selectedDate] = { chapters, completed };
            saveCalendarData(calendarData);
            
            generateCalendar();
            updateProgressMessage();
            closeModal();
        }

        // æ›¸ã®è¡¨ç¤º/éè¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆ
        function toggleBook(bookId) {
            const bookContent = document.getElementById(`book-${bookId}`);
            const toggleButton = document.getElementById(`toggle-${bookId}`);
            
            if (bookContent.classList.contains('hidden')) {
                bookContent.classList.remove('hidden');
                toggleButton.textContent = 'éè¡¨ç¤º';
            } else {
                bookContent.classList.add('hidden');
                toggleButton.textContent = 'è¡¨ç¤º';
            }
        }
        
        // ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã®ç”Ÿæˆ
        function generateChecklist() {
            const panel = document.getElementById('checklistPanel');
            const progress = getProgress();
            const todayList = getTodayReadingList();
            let html = '';

            Object.keys(bibleData).forEach(testament => {
                html += `<div class="testament">`;
                html += `<div class="testament-title">${testament}</div>`;
                
                Object.keys(bibleData[testament]).forEach(book => {
                    const chapterCount = bibleData[testament][book];
                    html += `<div class="book">`;
                    const bookId = book.replace(/[^a-zA-Z0-9]/g, '');
                    html += `<div class="book-title">`;
                    html += `<span>${book} (${chapterCount}ç« )</span>`;
                    html += `<button class="book-toggle" onclick="toggleBook('${bookId}')" id="toggle-${bookId}">è¡¨ç¤º</button>`;
                    html += `</div>`;
                    html += `<div class="chapters book-content" id="book-${book.replace(/[^a-zA-Z0-9]/g, '')}">`;            
                    html += `<div class="chapter-grid">`;
                    
                    for (let chapter = 1; chapter <= chapterCount; chapter++) {
                        const chapterKey = `${book}_${chapter}`;
                        const isCompleted = progress[chapterKey] || false;
                        const isTodaySelected = todayList.includes(chapterKey);
                        const completedClass = isCompleted ? 'completed' : '';
                        
                        html += `<div class="chapter-item ${completedClass}" data-book="${book}" data-chapter="${chapter}" title="${book} ${chapter}ç« ">`;
                        html += `<div style="display: flex; flex-direction: column; align-items: center; width: 100%;">`;
                        html += `<div style="font-weight: bold; font-size: 14px; margin-bottom: 2px;">${chapter}</div>`;
                        if (!isCompleted) {
                            html += `<input type="checkbox" class="chapter-checkbox" ${isTodaySelected ? 'checked' : ''} onchange="toggleChapter('${chapterKey}', this.checked)">`;
                        } else {
                            html += `<input type="checkbox" class="chapter-checkbox" checked disabled>`;
                        }
                        html += `<a href="#" class="chapter-link" onclick="openBibleText('${book}', ${chapter})" title="è–æ›¸æœ¬æ–‡ã‚’è¡¨ç¤º">ğŸ“–</a>`;
                        html += `</div>`;
                        html += `</div>`;
                    }
                    
                    html += `</div></div></div>`;
                });
                
                html += `</div>`;
            });

            panel.innerHTML = html;
        }

        // ä»Šæ—¥ã®èª­æ›¸ãƒªã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®å–å¾—
        function getTodayReadingList() {
            const saved = localStorage.getItem('today_reading_list');
            return saved ? JSON.parse(saved) : [];
        }
        
        // ä»Šæ—¥ã®èª­æ›¸ãƒªã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜
        function saveTodayReadingList(list) {
            localStorage.setItem('today_reading_list', JSON.stringify(list));
        }
        
        // ãƒã‚§ãƒƒã‚¯çŠ¶æ…‹ã®åˆ‡ã‚Šæ›¿ãˆï¼ˆä»Šæ—¥ã®èª­æ›¸ç”¨ï¼‰
        function toggleChapter(chapterKey, isChecked) {
            let todayList = getTodayReadingList();
            
            if (isChecked) {
                if (!todayList.includes(chapterKey)) {
                    todayList.push(chapterKey);
                }
            } else {
                todayList = todayList.filter(key => key !== chapterKey);
            }
            
            saveTodayReadingList(todayList);
            updateTodayReadingDisplay();
            
            // è¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
            const chapterItem = document.querySelector(`[data-book="${chapterKey.split('_')[0]}"][data-chapter="${chapterKey.split('_')[1]}"]`);
            if (chapterItem) {
                if (isChecked) {
                    chapterItem.classList.add('completed');
                } else {
                    chapterItem.classList.remove('completed');
                }
            }
        }

        // ä»Šæ—¥ã®èª­æ›¸è¡¨ç¤ºã‚’æ›´æ–°
        function updateTodayReadingDisplay() {
            const todayList = getTodayReadingList();
            const todayReadingListEl = document.getElementById('todayReadingList');
            
            if (todayList.length === 0) {
                todayReadingListEl.innerHTML = '<p>ä»Šæ—¥èª­ã‚€äºˆå®šã®ç« ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</p>';
            } else {
                let html = '<div class="today-chapters">';
                todayList.forEach(chapterKey => {
                    const [book, chapter] = chapterKey.split('_');
                    html += `<div class="reading-today">${book} ${chapter}ç« </div>`;
                });
                html += '</div>';
                todayReadingListEl.innerHTML = html;
            }
        }
        
        // ä»Šæ—¥ã®èª­æ›¸ã‚’ç¢ºå®š
        function confirmTodayReading() {
            const todayList = getTodayReadingList();
            const chapterCount = todayList.length;
            
            // é€²æ—ãƒ‡ãƒ¼ã‚¿ã«ä¿å­˜
            const progress = getProgress();
            todayList.forEach(chapterKey => {
                progress[chapterKey] = true;
            });
            saveProgress(progress);
            
            // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ‡ãƒ¼ã‚¿ã«ä¿å­˜
            const today = getTodayKey();
            const calendarData = getCalendarData();
            calendarData[today] = { 
                chapters: chapterCount, 
                completed: true,
                readChapters: todayList
            };
            saveCalendarData(calendarData);
            
            // ä»Šæ—¥ã®ãƒªã‚¹ãƒˆã‚’ã‚¯ãƒªã‚¢
            saveTodayReadingList([]);
            
            // è¡¨ç¤ºã‚’æ›´æ–°
            generateChecklist();
            updateTodayReadingDisplay();
            updateProgressMessage(chapterCount);
            
            // è©•ä¾¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
            showEvaluationMessage(chapterCount);
        }
        
        // è©•ä¾¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
        function showEvaluationMessage(chapterCount) {
            let message = '';
            let title = 'ä»Šæ—¥ã®èª­æ›¸çµæœ';
            
            if (chapterCount === 0) {
                message = 'ä»Šæ—¥ã¯èª­ã‚ã¾ã›ã‚“ã§ã—ãŸã€‚æ˜æ—¥ã¯é ‘å¼µã‚Šã¾ã—ã‚‡ã†ã€‚';
            } else if (chapterCount >= 1 && chapterCount <= 2) {
                message = `ä»Šæ—¥ã¯${chapterCount}ç« èª­ã‚ã¾ã—ãŸã€‚3ç« ã¾ã§ã‚ã¨å°‘ã—ã§ã™ã€‚é ‘å¼µã‚Šã¾ã—ã‚‡ã†ã€‚`;
            } else if (chapterCount >= 3) {
                message = `ä»Šæ—¥ã¯${chapterCount}ç« èª­ã‚ã¾ã—ãŸã­ã€‚3ç« ä»¥ä¸Šèª­ã‚ã¾ã—ãŸã€‚é ‘å¼µã‚Šã¾ã—ãŸã­ã€‚`;
            }
            
            alert(`${title}\n\n${message}`);
        }
        
        // é€²æ—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æ›´æ–°
        function updateProgressMessage(chapterCount = null) {
            const messageEl = document.getElementById('progressMessage');
            
            if (chapterCount === null) {
                const today = getTodayKey();
                const calendarData = getCalendarData();
                const todayData = calendarData[today] || { chapters: 0, completed: false };
                chapterCount = todayData.chapters;
            }
            
            if (chapterCount === 0) {
                messageEl.textContent = 'ä»Šæ—¥ã¯èª­ã‚ã¾ã›ã‚“ã§ã—ãŸã€‚æ˜æ—¥ã¯é ‘å¼µã‚Šã¾ã—ã‚‡ã†ã€‚';
            } else if (chapterCount >= 1 && chapterCount <= 2) {
                messageEl.textContent = 'ä»Šæ—¥ã¯3ç« ã¾ã§ã‚‚ã†å°‘ã—ã§ã™ã€‚é ‘å¼µã‚Šã¾ã—ã‚‡ã†ã€‚';
            } else if (chapterCount >= 3) {
                messageEl.textContent = 'ä»Šæ—¥ã¯3ç« ä»¥ä¸Šèª­ã‚ã¾ã—ãŸã­ã€‚é ‘å¼µã‚Šã¾ã—ãŸã­ã€‚';
            }
        }

        // è–æ›¸æœ¬æ–‡ã‚’é–‹ã
        function openBibleText(book, chapter) {
            const bibleDisplay = document.getElementById('bibleDisplay');
            const salterraeUrl = `https://www.wordproject.org/bibles/jp/`;
            
            bibleDisplay.innerHTML = `
                <h4>${book} ${chapter}ç« </h4>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 5px; margin: 10px 0;">
                    <p style="margin-bottom: 10px;"><strong>é¸æŠã•ã‚ŒãŸç®‡æ‰€:</strong> ${book} ${chapter}ç« </p>
                    <p style="margin-bottom: 15px;">å£èªè¨³è–æ›¸ã®æœ¬æ–‡ã‚’èª­ã‚€ã«ã¯ã€ä»¥ä¸‹ã®ã‚µã‚¤ãƒˆã‚’ã”åˆ©ç”¨ãã ã•ã„ï¼š</p>
                    <div style="margin: 15px 0;">
                        <a href="${salterraeUrl}" target="_blank" style="display: inline-block; padding: 10px 15px; background: #1976d2; color: white; text-decoration: none; border-radius: 4px; margin: 5px;">å£èªè¨³è–æ›¸ã‚µã‚¤ãƒˆã§èª­ã‚€</a>
                    </div>
                </div>
                <div style="margin-top: 20px; border: 1px solid #ddd; border-radius: 5px;">
                    <iframe src="${salterraeUrl}" class="bible-iframe" title="å£èªè¨³è–æ›¸ - ${book} ${chapter}ç« "></iframe>
                </div>
            `;
        }

        // åˆæœŸåŒ–
        function init() {
            generateChecklist();
            updateTodayReadingDisplay();
            updateProgressMessage();
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>